<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Marcin Copik | Single-source GPU programming</title>
<meta name="description" content="Personal webpage">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.css" integrity="sha512-WgL+hxwL4NdLGGZ4Euo/BmGAcQgyRRJsTQbNPGui+nWlzaF+3f2zf2rh578ccU3YINJCi8LvHyV1OHLJ8effBA==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.xyz/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ”¥</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/projects/hpx_gpu/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       Marcin Copik
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item ">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/talks/">
                talks
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/students/">
                students
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/misc/">
                miscellaneous
                
              </a>
          </li>
          
          
          <li class="nav-item">
            <a class="nav-link" href="/assets/pdf/cv.pdf" target="_blank" rel="nofollow">
              CV
            </a>
          </li>
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">Single-source GPU programming</h1>
    <p class="post-description">Incorporating Khronos SYCL into HPX.</p>
  </header>

  <article>
    
      <div class="project-summary">

      <ul>
        
          <li>
            
              <a href="/publications#2017sycl" title="paper" target="_blank" rel="nofollow">
            
              <i class="fas fa-scroll"></i><span>Paper @ IWOCL Workshop</span>
              </a>
          </li>
        

        

        
          <li>
            
              <a href="https://github.com/mcopik/hpx/tree/compute_sycl" title="github" target="_blank" rel="nofollow">
              <i class="fab fa-github"></i><span>mcopik/hpx/tree/compute_sycl</span>
            
            </a>
          </li>
        

        

        
      </ul>
      </div>
    
    <div style="vertical-align:middle; text-align:center">
  <a href="/assets/img/sycl/hpx.png">
    <img class="img-fluid rounded z-depth-1" src="/assets/img/sycl/hpx.png" alt="" title="HPX." style="max-width:100%;width:70%;" />
  </a>
</div>
<div class="caption">
  The components of shared and distributed memory programming in HPX.
</div>

<p>In the last years, the HPC world has moved to more heterogeneous architectures, exploiting hardware
offering different types of parallelism and enforcing specific programming models.
It has become a standard practice to offload computations to dedicated accelerators, and it is
expected that the importance of massively parallel processors will increase.
However, up to now, we have not seen a standardized C++ approach that would allow for writing portable
code for heterogeneous systems.</p>

<p>HPX is a parallel runtime system for applications of any scale, exposing parallelism API conforming
to the newest developments in the C++ standards.
However, it lacks the integration of computing accelerators.</p>

<div style="vertical-align:middle; text-align:center">
  <a href="/assets/img/sycl/hpx_internal.png">
    <img class="img-fluid rounded z-depth-1" src="/assets/img/sycl/hpx_internal.png" alt="" title="OpenCL callbacks." style="max-width:100%;width:70%;" />
  </a>
</div>
<div class="caption">
  The high-level overview of the parallel executor model in HPX.
</div>

<p><a href="https://link.springer.com/chapter/10.1007%2F978-3-319-46079-6_2">HPX.Compute</a> is an attempt to
solve the heterogeneous programming problem using standard C++ language and libraries.
The system is designed on top of three concepts: <strong>allocators</strong> responsible for memory management,
<strong>target</strong> providing an opaque view of a device, and <strong>executor</strong> responsible for scheduling
computations on a target.
The design is orthogonal to compilers, libraries, and other vendor-specific changes.</p>

<div style="vertical-align:middle; text-align:center">
  <a href="/assets/img/sycl/sycl_overview.png">
    <img class="img-fluid rounded z-depth-1" src="/assets/img/sycl/sycl_overview.png" alt="" title="Overview of SYCL compilers." style="max-width:100%;width:70%;" />
  </a>
</div>
<div class="caption">
An overview of the SYCL frameworks, compilers, and backends.
<a href="https://www.khronos.org/blog/sycl-2020-what-do-you-need-to-know">Source of the image</a>.
</div>

<p>We implemented the HPX.Compute model on top of <a href="https://www.khronos.org/sycl/">Khronos SYCL</a>, the new standard for single-source
GPU programming. SYCL is built on top of OpenCL semantics, and it brings simplified memory management
and support for C++ kernels while providing portability guarantees similar to OpenCL.
The SYCL compiler accepts a C++ source file, looks for SYCL kernels and compiles them to SPIR-V
bitcode. Later, the same source code is compiled with a regular C++ compiler, and the SYCL bitcode is linked
with it. We used <a href="https://developer.codeplay.com/products/computecpp/ce/home">ComputeCpp</a>,
which at the time was the only SYCL compiler and framework with a complete implementation.</p>

<div style="vertical-align:middle; text-align:center">
  <a href="/assets/img/sycl/futures.png">
    <img class="img-fluid rounded z-depth-1" src="/assets/img/sycl/futures.png" alt="" title="OpenCL callbacks." style="max-width:100%;width:70%;" />
  </a>
</div>
<div class="caption">
  Implementation of C++ futures with OpenCL callbacks.
</div>

<p>We implemented <strong>allocators</strong> using SYCL buffers, <strong>targets</strong> encapsulating SYCL device, and
<strong>HPX executors</strong> scheduling the parallel <code class="language-plaintext highlighter-rouge">for_each</code> algorithm on SYCL targets.
To implement asynchronous programming with futures, we needed a way to receive a callback from
SYCL that the kernel execution has finished, and we can change the state of the promise tied with
a future object returned to the user.
Unfortunately, SYCL does not have a native interface for callbacks.
However, it does have rich cooperation with OpenCL, and we were able to access and use
the underlying OpenCL system.
We implemented the futures without any hacks, and the compiler does the heavy lifting of compiling
GPU code for us!</p>

<div class="row justify-content-sm-center align-items-center">
  <div class="col-sm-6 mt-3 mt-md-0">
    <a href="/assets/img/sycl/stream_bw_305.png">
      <img class="img-fluid rounded z-depth-1" src="/assets/img/sycl/stream_bw_305.png" alt="" title="STREAM benchmark." />
    </a>
  </div>
  <div class="col-sm-6 mt-3 mt-md-0">
    <a href="/assets/img/sycl/stream_bw.png">
      <img class="img-fluid rounded z-depth-1" src="/assets/img/sycl/stream_bw.png" alt="" title="STREAM benchmark." />
    </a>
  </div>
</div>
<div class="caption">
  STREAM benchmark on arrays from less than 1 MB to 305 MB, on a single AMD GPU R9 Nano. 
</div>

<p>Using <a href="https://www.cs.virginia.edu/stream/">the STREAM benchmark</a>, we have shown that SYCL kernels can be integrated with HPX with minimal performance overheads,
<strong>including the asynchronous executions with <code class="language-plaintext highlighter-rouge">hpx::future</code></strong>.
Furthermore, our implementation provides <strong>high-performance GPU computations with a native C++ interface</strong>
similar to CPU programming.</p>

<p>This work is a result of my internship at the <a href="https://stellar.cct.lsu.edu">STE||AR Group</a> at the <a href="https://www.lsu.edu/">Louisiana
State University</a> in summer 2016.
During that time, I worked on C++AMP, AMD HC, and Khronos SYCL as potential implementation
backends for GPU programming in HPX.
We presented our paper <a href="/publications#2017sycl">at the DHPCC++ 2017 at the 9th International Workshop on OpenCL and SYCL</a>.</p>

  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2021 Marcin  Copik.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme.

    
    
    Last updated: July 20, 2021.
    
  </div>
</footer>

<script type="text/javascript" src="/assets/js/lightbox.js"></script>
<link rel="stylesheet" href="/assets/css/lightbox.css">


  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
